<!DOCTYPE html>
<html>
    <meta charset="UTF-8">
    <body>
        <div style="max-width:500px;">
            <h2 style="margin:5px;">Offerer</h2>
            <input type="text" id="offererId" style="margin:5px;" placeholder="Enter your user ID"/>
            <button id="openOffererSocket" style="margin:5px;">Open offerer web socket</button>
            <input type="text" id="recepientId" style="display: inline-block; margin:5px;" placeholder="Enter file recepient ID"/>
            <input type="file" id="sendFile" style="display: inline-block; margin:5px;"/>
            <button id="sendFile" style="display: block; margin:5px;">Send file to recepient</button>
        </div>
        <div style="max-width:500px;">
            <h2>Answerer</h2>
            <input type="text" id="answererId" style="margin:5px;" placeholder="Enter your user ID"/>
            <button id="openAnswererSocket" style="margin-top:5px;">Open answerer web socket</button>
            <a id="downloadFile" style="display: none; margin-top:10px;" download>Download uploaded file</a>
        </div>
    </body>
    <script src="adapter.js"></script>
    <script src="signaling/Offerer.js" type="module"></script>
    <script src="signaling/Answerer.js" type="module"></script>
    <script type="module">
        import {openWebSocket, sendFile} from "./signaling/Offerer.js";
        import {registerAsAnswerer, onFileReceived} from "./signaling/Answerer.js";

        document.getElementById('openOffererSocket').onclick = () => openWebSocket(document.getElementById('offererId').value);
        document.getElementById('sendFile').addEventListener('change', (e) => sendFile(e.target.files[0]));
        document.getElementById('openAnswererSocket').onclick = registerAsAnswerer;
        onFileReceived((file, metadata) => {
            const downloadButton = document.getElementById('downloadFile');
            downloadButton.href = URL.createObjectURL(file);
            downloadButton.style.display = 'block';
            !!metadata && (downloadButton.download = metadata.name);
        });
    </script>
</html>
